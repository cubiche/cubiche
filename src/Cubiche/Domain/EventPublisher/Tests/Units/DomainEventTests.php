<?php

/**
 * This file is part of the Cubiche/Event component.
 *
 * Copyright (c) Cubiche
 *
 * For the full copyright and license information, please view the LICENSE
 * file that was distributed with this source code.
 */

namespace Cubiche\Domain\EventPublisher\Tests\Units;

use Cubiche\Domain\EventPublisher\DomainEvent;
use Cubiche\Domain\EventPublisher\Tests\Fixtures\IncrementCounterEvent;

/**
 * DomainEvent class.
 *
 * Generated by TestGenerator on 2016-05-03 at 14:58:41.
 */
class DomainEventTests extends TestCase
{
    /**
     * Test eventName method.
     */
    public function testEventName()
    {
        $this
            ->given($event = new DomainEvent())
            ->then()
                ->string($event->eventName())
                    ->isEqualTo(DomainEvent::class)
                ->and()
                ->when($event = new DomainEvent('on_push'))
                ->then()
                    ->string($event->eventName())
                        ->isEqualTo('on_push')
        ;
    }

    /**
     * Test OccurredOn method.
     */
    public function testOccurredOn()
    {
        $this
            ->given($event = new DomainEvent())
            ->then()
                ->object($event->occurredOn())
                    ->isInstanceOf(\DateTime::class)
        ;
    }

    /**
     * Test StopPropagation method.
     */
    public function testStopPropagation()
    {
        $this
            ->given($event = new DomainEvent())
            ->then()
                ->boolean($event->isPropagationStopped())
                    ->isFalse()
                ->and()
                ->when($event->stopPropagation())
                ->then()
                    ->boolean($event->isPropagationStopped())
                        ->isTrue()
        ;
    }

    /**
     * Test SetPayload method.
     */
    public function testSetPayload()
    {
        $this
            ->given($event = new IncrementCounterEvent(5))
            ->then()
                ->object($event->occurredOn())
                    ->isInstanceOf(\DateTime::class)
                ->integer($event->step())
                    ->isEqualTo(5)
        ;
    }

    /**
     * Test ToArray method.
     */
    public function testToArray()
    {
        $this
            ->given($event = new IncrementCounterEvent(3))
            ->then()
                ->array($event->toArray())
                    ->child['metadata'](function ($metadata) {
                        $metadata
                            ->hasKey('occurredOn')
                            ->string['eventType']
                                ->isEqualTo(IncrementCounterEvent::class)
                        ;
                    })
                    ->child['payload'](function ($payload) {
                        $payload
                            ->isEqualTo(array(
                                'step' => 3,
                            ))
                        ;
                    })
        ;
    }

    /**
     * Test FromArray method.
     */
    public function testFromArray()
    {
        $this
            ->given($event = new IncrementCounterEvent(3))
            ->and($eventFromArray = IncrementCounterEvent::fromArray($event->toArray()))
            ->then()
                ->object($eventFromArray)
                    ->isInstanceOf(IncrementCounterEvent::class)
                ->object($event->occurredOn())
                    ->isEqualTo($eventFromArray->occurredOn())
                ->string($event->eventName())
                    ->isEqualTo($eventFromArray->eventName())
                ->integer($event->step())
                    ->isEqualTo($eventFromArray->step())
                ->boolean($event->isPropagationStopped())
                    ->isEqualTo($eventFromArray->isPropagationStopped())
        ;
    }
}
